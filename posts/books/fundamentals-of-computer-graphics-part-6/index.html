<!DOCTYPE html>
<html lang="english" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Fundamentals of Computer Graphics, Part 6 - nitishpuri.github.io</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/posts/books/fundamentals-of-computer-graphics-part-6/">

        <meta name="author" content="Peter Shirley" />
        <meta name="keywords" content="graphics,notes,programming" />
        <meta name="description" content="Data Structures for Graphics and More Ray Tracing" />

        <meta property="og:site_name" content="nitishpuri.github.io" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Fundamentals of Computer Graphics, Part 6"/>
        <meta property="og:url" content="/posts/books/fundamentals-of-computer-graphics-part-6/"/>
        <meta property="og:description" content="Data Structures for Graphics and More Ray Tracing"/>
        <meta property="article:published_time" content="2017-11-20" />
            <meta property="article:section" content="books" />
                <meta property="article:subcategory" content="books/fund-comp-graphics" />
            <meta property="article:tag" content="graphics" />
            <meta property="article:tag" content="notes" />
            <meta property="article:tag" content="programming" />
            <meta property="article:author" content="Peter Shirley" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link href="/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/custom.css" rel="stylesheet" type="text/css" />





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
nitishpuri.github.io            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/pages/bio/">Bio</a></li>
                    <li><a href="/pages/gallery/">Gallery</a></li>
                    <li><a href="/pages/books/">Books</a></li>
                    <li><a href="https://nitishpuri.github.io/ProcessingExperiments/">Demos</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="/archives/"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/posts/books/fundamentals-of-computer-graphics-part-6/"
                       rel="bookmark"
                       title="Permalink to Fundamentals of Computer Graphics, Part 6">
                        Fundamentals of Computer Graphics, Part 6
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-11-20T00:00:00+05:30"> Mon 20 November 2017</time>
    </span>


            <span class="label label-default">By</span>
            <a href="/author/peter-shirley.html"><i class="fa fa-user"></i> Peter Shirley</a>

        <span class="label label-default">Category</span>
        <a href="/category/books/">books</a>

            <a href="/category/books/fund-comp-graphics/">/fund-comp-graphics</a>
        



<span class="label label-default">Tags</span>
	<a href="/tag/graphics/">graphics</a>
        /
	<a href="/tag/notes/">notes</a>
        /
	<a href="/tag/programming/">programming</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>

    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
<section class="well" id="related-posts">
    <h4>Part 7 of the Fundamentals of Computer Graphics series</h4>
       <h5>Previous articles</h5>
       <ul>
           <li><a href="/posts/books/fundamentals-of-computer-graphics/">Fundamentals of Computer Graphics</a></li>
           <li><a href="/posts/books/fundamentals-of-computer-graphics-part-1/">Fundamentals of Computer Graphics, Part 1</a></li>
           <li><a href="/posts/books/fundamentals-of-computer-graphics-part-2/">Fundamentals of Computer Graphics, Part 2</a></li>
           <li><a href="/posts/books/fundamentals-of-computer-graphics-part-3/">Fundamentals of Computer Graphics, Part 3</a></li>
           <li><a href="/posts/books/fundamentals-of-computer-graphics-part-4/">Fundamentals of Computer Graphics, Part 4</a></li>
           <li><a href="/posts/books/fundamentals-of-computer-graphics-part-5/">Fundamentals of Computer Graphics, Part 5</a></li>
       </ul>
</section>
                
                <p>Contents:</p>
                <nav class="toc">
                  <div id="toc"><ul><li><a class="toc-href" href="#chapter-12-data-structures-for-graphics" title="Chapter 12 : Data Structures for Graphics">Chapter 12 : Data Structures for Graphics</a><ul><li><a class="toc-href" href="#triangle-meshes" title="Triangle Meshes">Triangle Meshes</a><ul><li><a class="toc-href" href="#mesh-topology" title="Mesh Topology">Mesh Topology</a></li><li><a class="toc-href" href="#triangle-strips-and-fans" title="Triangle Strips and Fans">Triangle Strips and Fans</a></li><li><a class="toc-href" href="#data-structures-for-mesh-connectivity" title="Data Structures for Mesh Connectivity">Data Structures for Mesh Connectivity</a></li><li><a class="toc-href" href="#the-triangle-neighbor-structure" title="The Triangle-Neighbor Structure">The Triangle-Neighbor Structure</a></li><li><a class="toc-href" href="#the-winged-edge-structure" title="The Winged-Edge structure">The Winged-Edge structure</a></li></ul></li><li><a class="toc-href" href="#scene-graphs_1" title="Scene Graphs">Scene Graphs</a></li><li><a class="toc-href" href="#spatial-data-structures" title="Spatial Data Structures">Spatial Data Structures</a><ul><li><a class="toc-href" href="#bounding-boxes" title="Bounding Boxes">Bounding Boxes</a></li><li><a class="toc-href" href="#hierarchical-bounding-boxes" title="Hierarchical Bounding Boxes">Hierarchical Bounding Boxes</a></li><li><a class="toc-href" href="#uniform-spatial-subdivision" title="Uniform Spatial Subdivision">Uniform Spatial Subdivision</a></li><li><a class="toc-href" href="#axis-aligned-binary-space-partitioning" title="Axis-Aligned Binary Space Partitioning">Axis-Aligned Binary Space Partitioning</a></li></ul></li><li><a class="toc-href" href="#bsp-trees-for-visibility_1" title="BSP Trees for Visibility">BSP Trees for Visibility</a><ul><li><a class="toc-href" href="#overview-of-bsp-tree-algorithm" title="Overview of BSP Tree Algorithm">Overview of BSP Tree Algorithm</a></li><li><a class="toc-href" href="#building-the-tree" title="Building the Tree">Building the Tree</a></li><li><a class="toc-href" href="#cutting-triangles" title="Cutting Triangles">Cutting Triangles</a></li><li><a class="toc-href" href="#optimizing-the-tree" title="Optimizing the Tree">Optimizing the Tree</a></li></ul></li><li><a class="toc-href" href="#tiling-multidimensional-arrays_1" title="Tiling Multidimensional Arrays">Tiling Multidimensional Arrays</a><ul><li><a class="toc-href" href="#one-level-tiling-for-2d-arrays" title="One-Level Tiling for 2D Arrays">One-Level Tiling for 2D Arrays</a></li></ul></li></ul></li></ul></div>
                </nav>
                <hr>
                
                <h2 id="chapter-12-data-structures-for-graphics">Chapter 12 : Data Structures for Graphics</h2>
<h3 id="triangle-meshes">Triangle Meshes</h3>
<p>Most real-world models are composed of complexes of triangles with shared vertices. These are usually known as <em>triangular meshes</em>, <em>triangle meshes</em>, or <em>triangular irregular networks (TINs)</em> and handling them efficiently is crucial to the performance of many graphics programs. <br/>
The minimum information required for a triangle mesh is a set of triangles (triples of vertices) and the positions (in 3D space) of their vertices. But many, if not most, programs require the ability to store additional data at the vertices, edges, or faces to support texture mapping, shading, animation, and other operations. Vertex data is the most common: each vertex can have material parameters, texture coordinates, irradiances&mdash;any parameters whose values change across the surface. These parameters are then linearly interpolated across each triangle to define a continuous function over the whole surface of the mesh. However, it is also occasionally important to be able to store data per edge or per face.   </p>
<h4 id="mesh-topology"><strong>Mesh Topology</strong></h4>
<ul>
<li>Every edge is shared by exactly two triangles.</li>
<li>Every vertex has a single, complete loop of triangles around it.</li>
</ul>
<p><img alt="" src="/images/fundcg/12_mesh1.png"/>
<img alt="" src="/images/fundcg/12_mesh1_1.png"/> <br/>
<img alt="" src="/images/fundcg/12_mesh2_1.png"/>
<img alt="" src="/images/fundcg/12_mesh2.png"/> <br/>
<img alt="" src="/images/fundcg/12_mesh3.png"/> </p>
<p><strong>Indexed Mesh Storage</strong> </p>
<div class="highlight"><pre><span></span><span class="n">Triangle</span> <span class="o">{</span>
     <span class="n">vector3</span> <span class="n">vertexPosition</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
<p><img alt="" src="/images/fundcg/12_mesh4.png"/> </p>
<div class="highlight"><pre><span></span><span class="n">Triangle</span> <span class="o">{</span>
     <span class="n">Vertex</span> <span class="n">v</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
<span class="o">}</span>
<span class="n">Vertex</span> <span class="o">{</span>
     <span class="n">vector3</span> <span class="n">position</span> <span class="c1">// or other vertex data</span>
<span class="o">}</span>
</pre></div>
<p><strong>Indexed triangle mesh</strong> </p>
<div class="highlight"><pre><span></span><span class="n">IndexedMesh</span> <span class="o">{</span>
     <span class="kt">int</span> <span class="n">tInd</span><span class="o">[</span><span class="n">nt</span><span class="o">][</span><span class="mi">3</span><span class="o">]</span>
     <span class="n">vector3</span> <span class="n">verts</span><span class="o">[</span><span class="n">nv</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
<h4 id="triangle-strips-and-fans"><strong>Triangle Strips and Fans</strong></h4>
<p><img alt="" src="/images/fundcg/12_mesh5.png"/> <br/>
<img alt="" src="/images/fundcg/12_mesh6.png"/> </p>
<h4 id="data-structures-for-mesh-connectivity"><strong>Data Structures for Mesh Connectivity</strong></h4>
<p>Indexed meshes, strips, and fans are all good, compact representations for static meshes. However, they do not readily allow for meshes to be modified. In order to efficiently edit meshes, more complicated data structures are needed to efficiently answer queries such as: <br/>
<em> Given a triangle, what are the three adjacent triangles?
</em> Given an edge, which two triangles share it?
<em> Given a vertex, which faces share it?
</em> Given a vertex, which edges share it?</p>
<p>The most straightforward, though bloated, implementation would be to have three types, <code>Vertex</code>, <code>Edge</code>, and <code>Triangle</code>, and to just store all the relationships directly:</p>
<div class="highlight"><pre><span></span><span class="n">Triangle</span> <span class="o">{</span>
     <span class="n">Vertex</span> <span class="n">v</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
     <span class="n">Edge</span> <span class="n">e</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
<span class="o">}</span>
<span class="n">Edge</span> <span class="o">{</span>
     <span class="n">Vertex</span> <span class="n">v</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
     <span class="n">Triangle</span> <span class="n">t</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
<span class="o">}</span>
<span class="n">Vertex</span> <span class="o">{</span>
     <span class="n">Triangle</span> <span class="n">t</span><span class="o">[]</span>
     <span class="n">Edge</span> <span class="n">e</span><span class="o">[]</span>
<span class="o">}</span>
</pre></div>
<p>The fixed-size arrays in the Edge and Triangle classes suggest that it will be more efficient to store the connectivity information there. In fact, for polygon meshes, in which polygons have arbitrary numbers of edges and vertices, only edges have fixed-size connectivity information, which leads to many traditional mesh data structures being based on edges. But for triangle-only meshes, storing connectivity in the (less numerous) faces is appealing.   </p>
<h4 id="the-triangle-neighbor-structure"><strong>The Triangle-Neighbor Structure</strong></h4>
<div class="highlight"><pre><span></span><span class="n">Triangle</span> <span class="o">{</span>
     <span class="n">Triangle</span> <span class="n">nbr</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
     <span class="n">Vertex</span> <span class="n">v</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
<span class="o">}</span>
<span class="n">Vertex</span> <span class="o">{</span>
     <span class="c1">// ... per-vertex data ...</span>
     <span class="n">Triangle</span> <span class="n">t</span><span class="o">;</span> <span class="c1">// any adjacent tri</span>
<span class="o">}</span>
</pre></div>
<p><img alt="" src="/images/fundcg/12_mesh8.png"/> <br/>
<img alt="" src="/images/fundcg/12_mesh9.png"/> </p>
<div class="highlight"><pre><span></span><span class="n">Mesh</span> <span class="o">{</span>
     <span class="c1">// ... per-vertex data ...</span>
     <span class="kt">int</span> <span class="n">tInd</span><span class="o">[</span><span class="n">nt</span><span class="o">][</span><span class="mi">3</span><span class="o">];</span> <span class="c1">// vertex indices</span>
     <span class="kt">int</span> <span class="n">tNbr</span><span class="o">[</span><span class="n">nt</span><span class="o">][</span><span class="mi">3</span><span class="o">];</span> <span class="c1">// indices of neighbor triangles</span>
     <span class="kt">int</span> <span class="n">vTri</span><span class="o">[</span><span class="n">nv</span><span class="o">];</span> <span class="c1">// index of any adjacent triangle</span>
<span class="o">}</span>
<span class="n">TrianglesOfVertex</span><span class="o">(</span><span class="n">v</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">t</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="na">t</span>
     <span class="k">do</span> <span class="o">{</span>
          <span class="n">find</span> <span class="n">i</span> <span class="n">such</span> <span class="nf">that</span> <span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">v</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="n">v</span><span class="o">)</span>
          <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">nbr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
     <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">t</span> <span class="o">!=</span> <span class="n">v</span><span class="o">.</span><span class="na">t</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
<h4 id="the-winged-edge-structure"><strong>The Winged-Edge structure</strong></h4>
<div class="highlight"><pre><span></span><span class="n">Edge</span> <span class="o">{</span>
     <span class="n">Edge</span> <span class="n">lprev</span><span class="o">,</span> <span class="n">lnext</span><span class="o">,</span> <span class="n">rprev</span><span class="o">,</span> <span class="n">rnext</span><span class="o">;</span>
     <span class="n">Vertex</span> <span class="n">head</span><span class="o">,</span> <span class="n">tail</span><span class="o">;</span>
     <span class="n">Face</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">Face</span> <span class="o">{</span>
     <span class="c1">// ... per-face data ...</span>
     <span class="n">Edge</span> <span class="n">e</span><span class="o">;</span> <span class="c1">// any adjacent edge</span>
<span class="o">}</span>
<span class="n">Vertex</span> <span class="o">{</span>
     <span class="c1">// ... per-vertex data ...</span>
     <span class="n">Edge</span> <span class="n">e</span><span class="o">;</span> <span class="c1">// any incident edge</span>
<span class="o">}</span>
</pre></div>
<p><strong>The Half-Edge Structure</strong> </p>
<div class="highlight"><pre><span></span><span class="n">HEdge</span> <span class="o">{</span>
     <span class="n">HEdge</span> <span class="n">pair</span><span class="o">,</span> <span class="n">next</span><span class="o">;</span>
     <span class="n">Vertex</span> <span class="n">v</span><span class="o">;</span>
     <span class="n">Face</span> <span class="n">f</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">Face</span> <span class="o">{</span>
     <span class="c1">// ... per-face data ...</span>
     <span class="n">HEdge</span> <span class="n">h</span><span class="o">;</span> <span class="c1">// any h-edge of this face</span>
<span class="o">}</span>
<span class="n">Vertex</span> <span class="o">{</span>
     <span class="c1">// ... per-vertex data ...</span>
     <span class="n">HEdge</span> <span class="n">h</span><span class="o">;</span> <span class="c1">// any h-edge pointing toward this vertex</span>
<span class="o">}</span>
</pre></div>
<h3 id="scene-graphs_1">Scene Graphs</h3>
<p><img alt="" src="/images/fundcg/12_scene1.png"/> <br/>
As with the pendulum, each object should be transformed by the product of the matrices in the path from the root to the object:    </p>
<ul>
<li><strong>ferry</strong> transform using <span class="math">\(M_0\)</span></li>
<li><strong>car body</strong> transform using <span class="math">\(M_0M_1\)</span></li>
<li><strong>left wheel</strong> transform using <span class="math">\(M_0M_1M_2\)</span></li>
<li><strong>left wheel</strong> transform using <span class="math">\(M_0M_1M_3\)</span></li>
</ul>
<p>An efficient implementation can be achieved using a <em>matrix stack</em>, a data structure supported by many APIs. A matrix stack is manipulated using <em>push</em> and <em>pop</em> operations that add and delete matrices from the right-hand side of a matrix product. <br/>
For example, calling: <br/>
</p>
<div class="math">$$
push(\mathbf M_0)\\
push(\mathbf M_1)\\
push(\mathbf M_2)
$$</div>
<p>creates the active matrix <span class="math">\(\mathbf M = \mathbf M_0 \mathbf M_1 \mathbf M_2\)</span>. A subsequent call to <em>pop()</em> strips the last matrix added so that the active matrix becomes <span class="math">\(\mathbf M = \mathbf M_0 \mathbf M_1\)</span>. Combining the matrix stack with a recursive traversal of a scene graph gives us:   </p>
<div class="math">$$
\mathbf{function}\; traverse(node)\\
\quad push(\mathbf M_{local})\\
\quad \text{draw object using composite matrix from stack} \\
\quad traverse(left\;child)\\
\quad traverse(right\;child)\\
\quad pop()
$$</div>
<h3 id="spatial-data-structures">Spatial Data Structures</h3>
<p><img alt="" src="/images/fundcg/12_spatial1.png"/> </p>
<h4 id="bounding-boxes"><strong>Bounding Boxes</strong></h4>
<h4 id="hierarchical-bounding-boxes"><strong>Hierarchical Bounding Boxes</strong></h4>
<div class="math">$$
\mathbf{if}\;\text{(ray hits root box)}\;\mathbf{then}\\
\quad \mathbf{if}\;\text{(ray hits left subtree box)}\; \mathbf{then}\\
\quad \quad \text{check three triangles for intersection} \\
\quad \mathbf{if}\; \text{(ray intersects right subtree box)}\; \mathbf{then}\\
\quad \quad \text{check other three triangles for intersection}\\
\quad \mathbf{if}\; \text{(an intersections returned from each subtree)} \mathbf{then} \\
\quad \quad \mathbf{return}\; \text{the closest of the two hits} \\
\quad \mathbf{else\,if}\;\text{(a intersection is returned from exactly one subtree)}\;\mathbf{then}\\
\quad \quad \mathbf{return}\; \text{that intersection} \\
\quad \mathbf{else}\\
\quad \quad \mathbf{return}\; false \\
\mathbf{else} \\
\quad \mathbf{return}\; false
$$</div>
<p>There are many ways to build a tree for a bounding volume hierarchy. It is convenient to make the tree binary, roughly balanced, and to have the boxes of sibling subtrees not overlap too much. A heuristic to accomplish this is to sort the surfaces along an axis before dividing them into two sublists.   </p>
<p>The quality of the tree can be improved by carefully choosing AXIS each time. One way to do this is to choose the axis such that the sum of the volumes of the bounding boxes of the two subtrees is minimized. This change compared to rotating through the axes will make little difference for scenes composed of isotopically distributed small objects, but it may help significantly in less well-behaved scenes. This code can also be made more efficient by doing just a partition rather than a full sort.   </p>
<h4 id="uniform-spatial-subdivision"><strong>Uniform Spatial Subdivision</strong></h4>
<ul>
<li>In hierarchical bounding volumes, each object belongs to one of two sibling nodes, whereas a point in space may be inside both sibling nodes.</li>
<li>In spatial subdivision, each point in space belongs to exactly one node, whereas objects may belong to many nodes.</li>
</ul>
<p>The grid itself should be a subclass of surface and should be implemented as a 3D array of pointers to surface. For empty cells these pointers are NULL. For cells with one object, the pointer points to that object. For cells with more than one object, the pointer can point to a list, another grid, or another data structure, such as a bounding volume hierarchy.   </p>
<p><img alt="" src="/images/fundcg/12_spatial2.png"/> </p>
<h4 id="axis-aligned-binary-space-partitioning"><strong>Axis-Aligned Binary Space Partitioning</strong></h4>
<p>A node in this structure contains a single cutting plane and a left and right subtree. Each subtree contains all the objects on one side of the cutting plane. Objects that pass through the plane are stored in in both subtrees. If we assume the cutting plane is parallel to the <span class="math">\(yz\)</span> plane at <span class="math">\(x = D\)</span>, then the node class is:   </p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">bsp</span><span class="o">-</span><span class="nx">node</span> <span class="nx">subclass</span> <span class="nx">of</span> <span class="nx">surface</span>
     <span class="nx">virtual</span> <span class="kt">bool</span> <span class="nx">hit</span><span class="p">(</span><span class="nx">ray</span> <span class="nx">e</span> <span class="o">+</span> <span class="nx">td</span><span class="p">,</span> <span class="nx">real</span> <span class="nx">t0</span><span class="p">,</span> <span class="nx">real</span> <span class="nx">t1</span><span class="p">,</span> <span class="nx">hit</span><span class="o">-</span><span class="nx">record</span> <span class="nx">rec</span><span class="p">)</span>
     <span class="nx">virtual</span> <span class="nx">box</span> <span class="nx">bounding</span><span class="o">-</span><span class="nx">box</span><span class="p">()</span>
     <span class="nx">surface</span><span class="o">-</span><span class="nx">pointer</span> <span class="nx">left</span>
     <span class="nx">surface</span><span class="o">-</span><span class="nx">pointer</span> <span class="nx">right</span>
     <span class="nx">real</span> <span class="nx">D</span>
</pre></div>
<h3 id="bsp-trees-for-visibility_1">BSP Trees for Visibility</h3>
<p>If we are making many images of a fixed scene composed of planar polygons, from different viewpoints&mdash;as is often the case for applications such as games&mdash; we can use a binary space partitioning scheme closely related to the method for ray intersection discussed in the previous section. The difference is that for visibility sorting we use non&ndash;axis-aligned splitting planes, so that the planes can be made coincident with the polygons. This leads to an elegant algorithm known as the BSP tree algorithm to order the surfaces from front to back. The key aspect of the BSP tree is that it uses a preprocess to create a data structure that is useful for any viewpoint. So, as the viewpoint changes, the same data structure is used without change.</p>
<h4 id="overview-of-bsp-tree-algorithm"><strong>Overview of BSP Tree Algorithm</strong></h4>
<p>The BSP tree algorithm is an example of a <strong>painter&rsquo;s algorithm</strong>. A painter&rsquo;s algorithm draws every object from back-to-front, with each new polygon potentially overdrawing previous polygons.   </p>
<h4 id="building-the-tree"><strong>Building the Tree</strong></h4>
<div class="math">$$
\mathbf{function} \; add ( \text{triangle}\;T )\\
\quad \mathbf{if}\,(f(\mathbf a) &lt; 0\;and\;f(\mathbf b) &lt; 0\;and\;f(\mathbf c) &lt; 0)\;\mathbf{then} \\
\quad \quad \mathbf{if}\, (\text{negative subtree is empty})\;\mathbf{then}\\
\quad \quad \quad \text{negative-subtree} = node(T) \\
\quad \quad \mathbf{else} \\
\quad \quad \quad \text{negative-subtree}.add(T) \\
\quad \mathbf{else\,if}\, (f(\mathbf a) &gt; 0 and f(\mathbf b) &gt; 0 and f(\mathbf c) &gt; 0)\; \mathbf{then}\\
\quad \quad \mathbf{if}\; \text{positive subtree is empty}\;\mathbf{then}\\
\quad \quad \quad \text{positive-subtree} = node(T) \\
\quad \quad \mathbf{else}\\
\quad \quad \quad \text{positive-subtree}.add (T) \\
\quad \mathbf{else} \\
\quad \quad \text{we have assumed this case is impossible}
$$</div>
<p><img alt="" src="/images/fundcg/12_bsp1.png"/>
<img alt="" src="/images/fundcg/12_bsp2.png"/> </p>
<p>A precision problem that will plague a naive implementation occurs when a vertex is very near the splitting plane. For example, if we have two vertices on one side of the splitting plane and the other vertex is only an extremely small distance on the other side, we will create a new triangle almost the same as the old one, a triangle that is a sliver, and a triangle of almost zero size. It would be better to detect this as a special case and not split into three new triangles. One might expect this case to be rare, but because many models have tessellated planes and triangles with  shared vertices, it occurs frequently, and thus must be handled carefully. Some simple manipulations that accomplish this are:</p>
<div class="math">$$
\mathbf {function}\;add( \text{triangle}\; T ) \\
\quad fa = f(\mathbf a)\\
\quad fb = f(\mathbf b)\\
\quad fc = f(\mathbf c)\\
\quad \mathbf{if}\; (abs(fa) &lt; \epsilon) \mathbf{then}\\
\quad \quad fa = 0 \\
\quad \mathbf{if}\; (abs(fb) &lt; \epsilon) \mathbf{then}\\
\quad \quad fb = 0 \\
\quad \mathbf{if}\; (abs(fc) &lt; \epsilon) \mathbf{then}\\
\quad \quad fc = 0 \\
\quad \mathbf{if}\; (fa \leq 0\;and\;fb \leq 0\;and\;fc \leq 0) \mathbf{then} \\
\quad \quad \mathbf{if}\; \text{(negative subtree is empty)}\;\mathbf{then} \\
\quad \quad \quad \text{negative-subtree} = node(T) \\
\quad \quad \mathbf{else} \\
\quad \quad \mathbf{negative-subtree}.add(T) \\
\quad \mathbf{else\,if}\;(fa \leq 0\;and\;fb \leq 0\;and\;fc \leq 0) \mathbf{then} \\
\quad \quad \mathbf{if}\; \text{(positive subtree is empty)}\;\mathbf{then}\\
\quad \quad \quad \text{positive-subtree} = node(T) \\
\quad \quad \mathbf{else} \\
\quad \quad \quad \text{positive-subtree}.add(T)\\
\quad \mathbf{else} \\
\quad \quad \text{cut triangle into three triangles and add to each side} 
$$</div>
<h4 id="cutting-triangles"><strong>Cutting Triangles</strong></h4>
<div class="math">$$
\mathbf{if}\; (fa * fc \geq 0)\;\mathbf{then}\\
\quad swap(fb, fc)\\
\quad swap(\mathbf b, \mathbf c) \\
\quad swap(fa, fb) \\
\quad swap(\mathbf a, \mathbf b) \\
\mathbf{else\,if}\; (fb &lowast; fc \geq 0)\;\mathbf{then} \\
\quad swap(fa, fc) \\
\quad swap(\mathbf a, \mathbf c) \\
\quad swap(fa, fb) \\
\quad swap(\mathbf a, \mathbf b) \\
compute\;\mathbf A \\
compute\;\mathbf B \\
T_1 = (\mathbf a, \mathbf b, \mathbf A) \\
T_2 = (\mathbf b, \mathbf B, \mathbf A) \\
T_3 = (\mathbf A, \mathbf B, \mathbf c) \\
\mathbf{if}\; (fc \geq 0)\;\mathbf{then} \\
\quad \text{negative-subtree}.add(T1) \\
\quad \text{negative-subtree}.add(T2) \\
\quad \text{positive-subtree}.add(T3) \\
\mathbf {else} \\
\quad \text{positive-subtree}.add(T1) \\
\quad \text{positive-subtree}.add(T2) \\
\quad \text{negative-subtree}.add(T3) \\
$$</div>
<h4 id="optimizing-the-tree"><strong>Optimizing the Tree</strong></h4>
<p>Mostly depends upon the order or triangle being added.   </p>
<h3 id="tiling-multidimensional-arrays_1">Tiling Multidimensional Arrays</h3>
<p><img alt="" src="/images/fundcg/12_tile1.png"/>
<img alt="" src="/images/fundcg/12_tile2.png"/> </p>
<h4 id="one-level-tiling-for-2d-arrays"><strong>One-Level Tiling for 2D Arrays</strong></h4>
<p><img alt="" src="/images/fundcg/12_tile3.png"/> </p>
<div class="math">$$
index = n^2(B_xb_y + b_x), \quad offset = y'n+x'.
$$</div>
<p>Thus the full formula for finding the 1D  index element <span class="math">\((x, y)\)</span> in an <span class="math">\(N_x \times N_y\)</span> array with <span class="math">\(n \times n\)</span>
tiles is, <br/>
</p>
<div class="math">$$\begin{align}
index &amp; = n^2(B_xb_y + b_x) + y'n + x' \\
&amp; = n^2((N_x /n)(y/n) + x/n) + (y\mod n)n + (x \mod n).
\end{align}$$</div>
<p>This expression contains many integer multiplication, divide and modulus operations, which are costly on some processors. When <span class="math">\(n\)</span> is a power of two, these operations can be converted to <em>bitshifts</em> and <em>bitwise logical operations</em>. However, as noted above, the ideal size is not always a power of two.   </p>
<p>However, there is a simple solution; note that the index expression can be written as <br/>
</p>
<div class="math">$$index  = F_x(x) + F_y(y),$$</div>
<p> <br/>
where, <br/>
</p>
<div class="math">$$\begin{align}
F_x(x) &amp; = n^2(x/n) + (x \mod n)\\
F_y(y) &amp; = n^2(N_x/n)(y/n) + (y \mod n)n
\end{align}$$</div>
<p>We tabulate <span class="math">\(F_x\)</span> and <span class="math">\(F_y\)</span>, and use <span class="math">\(x\)</span> and <span class="math">\(y\)</span> to find the index into the data array. These tables will consist of <span class="math">\(N_x\)</span> and <span class="math">\(N_y\)</span> elements, respectively. The total size of the tables will fit in the primary data cache of the processor, even for very large data set sizes.   </p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "left",
        indent = "0em",
        linebreak = "true";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

            
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'nitishpuri'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://www.facebook.com/npuri1903"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
    <li class="list-group-item"><a href="https://github.com/nitishpuri"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
    <li class="list-group-item"><a href="https://www.linkedin.com/in/nitishpuri/"><i class="fa fa-linkedin-square fa-lg"></i> Linkedin</a></li>
    <li class="list-group-item"><a href="https://www.instagram.com/purinitish/"><i class="fa fa-instagram fa-lg"></i> Instagram</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Categories -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4>
  <ul class="list-group" id="categories">
    <li class="list-group-item">
      <a href="/category/articles/"><i class="fa fa-folder-open fa-lg"></i>articles</a>
    </li>
    <li class="list-group-item">
      <a href="/category/books/"><i class="fa fa-folder-open fa-lg"></i>books</a>
    </li>
    <li class="list-group-item">
      <a href="/category/gallery/"><i class="fa fa-folder-open fa-lg"></i>gallery</a>
    </li>
    <li class="list-group-item">
      <a href="/category/machine-intelligence/"><i class="fa fa-folder-open fa-lg"></i>machine-intelligence</a>
    </li>
    <li class="list-group-item">
      <a href="/category/robotics/"><i class="fa fa-folder-open fa-lg"></i>robotics</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Categories -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-1">
      <a href="/tag/algorithms/">algorithms</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/blogging/">blogging</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/book/">book</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/data-science/">data-science</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/deep-learning/">deep-learning</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/design/">design</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/gallery/">gallery</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/generative/">generative</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/graphics/">graphics</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/image-segmentation/">image-segmentation</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/jekyll/">jekyll</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="/tag/notes/">notes</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/opengl/">opengl</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/philosophy/">philosophy</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="/tag/programming/">programming</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/projects/">projects</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="/tag/robotics/">robotics</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/sketch/">sketch</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="/tag/style-transfer/">style-transfer</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="/tag/udacity/">udacity</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Series -->
<li class="list-group-item">
  <h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Series</span></h4>
  <ul class="list-group">
    <li class="list-group-item">
      <h5></i>Previous article</h5>
      <a href="/posts/books/fundamentals-of-computer-graphics-part-5/">Fundamentals of Computer Graphics, Part 5</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Series -->


<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
</li>
<!-- End Sidebar/Github -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Nitish Puri
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.english"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.english">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = '/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'nitishpuri',
    count: 5,
    skip_forks: true,
    target: '#gh_repos'
  });
});
</script>
<script src="/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'nitishpuri'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-103032011-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->


    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-59bc69ad3aa13e47"></script>
</body>
</html>